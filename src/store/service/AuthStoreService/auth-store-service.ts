import RootStore from '../../RootStore'import {LoadingEnum} from '../../types/types'import {deviceStorage} from '../../../utils/storage/storage'import {checkToken} from "../../../utils/commonUtils";import {routerConstants} from "../../../constants/routerConstants";import {da} from "date-fns/locale";import {AuthGooglePayload, RegisterPayloadType} from "../../../api/type";export class AuthStoreService {    rootStore: typeof RootStore    constructor(rootStore: typeof RootStore) {        this.rootStore = rootStore    }    async sendVerifyCode(code: string): Promise<any | void> {        try {            const data = await this.rootStore.AuthStore.sendVerifyCode(code)            return data.data        } catch (e) {            this.rootStore.Notification.setNotification({serverResponse: e?.message})        } finally {        }    }    async sendCode(formattedPhoneNumber?: string): Promise<boolean | void> {        this.rootStore.Notification.setIsLoading(LoadingEnum.fetching)        try {            const data = await this.rootStore.AuthStore.sendCode(formattedPhoneNumber)            return true        } catch (e) {            this.rootStore.Notification.setNotification({serverResponse: e?.message})        } finally {            this.rootStore.Notification.setIsLoading(LoadingEnum.success)        }    }    async sendRegister(payload: RegisterPayloadType): Promise<boolean | void> {        try {            const data = await this.rootStore.AuthStore.sendRegister(payload)            if (data.status === 'error') {                this.rootStore.Notification.setNotification({serverResponse: data?.message})            }            return true        } catch (e) {            this.rootStore.Notification.setNotification({serverResponse: e?.message})        } finally {        }    }    async updateUserInfo(payload): Promise<boolean | void> {        this.rootStore.Notification.setLocalLoading(LoadingEnum.fetching)        try {            await this.rootStore.AuthStore.sendRegister(payload)            await this.rootStore.AuthStore.getSettingExecutor()            if (payload.language) {                //await this.rootStore.DictionaryStore.sendDictionary(payload.language)            }            return true        } catch (e) {            console.log(e)        } finally {            this.rootStore.Notification.setLocalLoading(LoadingEnum.success)        }    }    async updatePhoto(photo: string): Promise<boolean | void> {        this.rootStore.Notification.setLocalLoading(LoadingEnum.fetching)        try {            await this.rootStore.AuthStore.updatePhoto(photo)            await this.rootStore.AuthStore.getSettingExecutor()            return true        } catch (e) {            return false        } finally {            this.rootStore.Notification.setLocalLoading(LoadingEnum.success)        }    }    async logout(): Promise<boolean | void> {        this.rootStore.Notification.setLocalLoading(LoadingEnum.fetching)        try {            await this.rootStore.AuthStore.logout()            await deviceStorage.removeItem('token')            this.rootStore.AuthStore.clearStore()            await deviceStorage.removeItem('tokenDate')            this.rootStore.AuthStore.setAuth(false)            return true        } catch (e) {            return false        } finally {            this.rootStore.Notification.setLocalLoading(LoadingEnum.success)        }    }    async authWithGoogle(payload: AuthGooglePayload): Promise<boolean | void> {//		this.rootStore.Notification.setLocalLoading(LoadingEnum.fetching)        try {            const data = await this.rootStore.AuthStore.authWithGoogle(payload)            return data?.token        } catch (e) {            this.rootStore.Notification.setNotification({serverResponse: e?.message})            return false        } finally {        }    }    async getSettingExecutor(navigate?: (key: string) => void) {        this.rootStore.Notification.setIsLoading(LoadingEnum.fetching)        try {            const checkValidToken = await checkToken()            if (!checkValidToken) return 'not_token'            const data = await this.rootStore.AuthStore.getSettingExecutor()            if (!data?.executors?.phone_verify_datetime) return navigate && navigate(routerConstants.PHONE_VERIFY)            if (!data?.executors?.consent_datetime) return navigate && navigate(routerConstants.TERMS_OF_USE)            this.rootStore.AuthStore.setAuth(true)            await this.rootStore.AuthStore.getLogisticPoints()            navigate(routerConstants.main)        } catch (e) {            this.rootStore.Notification.setNotification({serverResponse: e?.message})        } finally {            setTimeout(() => {                this.rootStore.Notification.setIsLoading(LoadingEnum.success)            }, 3000)        }    }}export default AuthStoreService